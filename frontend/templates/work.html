<div class="work-modal" id="work-modal" hidden aria-hidden="true">
    <div class="modal__overlay work-modal__overlay" data-work-overlay></div>
    <div class="work-modal__panel" role="dialog" aria-modal="true" aria-labelledby="work-dialog-title" tabindex="-1">
        <header class="work-modal__header">
            <div>
                <p class="muted" data-i18n="modal.header">{{ _('modal.header') }}</p>
                <h2 id="work-dialog-title" data-i18n="work.title">{{ _('work.title') }}</h2>
            </div>
            <button class="modal-close" type="button" data-work-close data-i18n-attr="aria-label:modal.close">
                <svg class="modal-close__icon" width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"
                    focusable="false" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <line x1="8" y1="8" x2="24" y2="24" />
                    <line x1="24" y1="8" x2="8" y2="24" />
                </svg>
            </button>
        </header>
        <div class="work-modal__grid" role="list">
            {% for project in projects %}
            <article class="work-card" role="listitem" data-project-index="{{ loop.index0 }}"
                data-images='{{ project.images | default([]) | tojson | safe }}'
                data-github-url="{{ project.github_url }}">
                <div class="work-card__image" aria-hidden="true" data-i18n-attr="aria-label:work.project_aria"
                    data-i18n-fallback="{{ project.title if project.title else _('work.no_data') }}">
                    <span class="visually-hidden" data-i18n="work.project_aria"
                        data-i18n-fallback="{{ project.title if project.title else _('work.no_data') }}">{{
                        project.title if project.title else
                        _('work.no_data') }}</span>

                    <!-- Carousel markup: prev / image / next -->
                    {% if project.images and (project.images | length) > 0 %}
                    {% set first_img = project.images[0] %}
                    {% if project.images | length > 1 %}
                    <button class="image-nav image-prev" type="button"
                        aria-label="{{ _('button.prev') if _('button.prev') else 'Previous' }}"><span
                            class="icon">‹</span></button>
                    {% endif %}

                    <img class="work-card__img" src="{{ url_for('static', filename='images/' + first_img) }}"
                        alt="{{ project.title if project.title else _('work.no_data') }}" tabindex="0" loading="lazy" />

                    {% if project.images | length > 1 %}
                    <button class="image-nav image-next" type="button"
                        aria-label="{{ _('button.next') if _('button.next') else 'Next' }}"><span
                            class="icon">›</span></button>
                    {% endif %}

                    {% else %}
                    <!-- No images: render an empty, inert image element to keep layout stable -->
                    <img class="work-card__img" src="" alt="{{ project.title if project.title else _('work.no_data') }}"
                        tabindex="-1" aria-hidden="true" />
                    {% endif %}
                </div>
                <div class="work-card__content">
                    <h3 data-i18n="work.projects.{{ loop.index0 }}.title" data-i18n-fallback="{{ project.title }}">{{
                        project.title }}</h3>
                    <p class="card-description" data-i18n="work.projects.{{ loop.index0 }}.description"
                        data-i18n-fallback="{{ project.description }}">{{ project.description }}</p>
                    <div class="card__actions work-card__links">
                        <a class="work-modal__btn about-btn" href="#" data-i18n="button.card_about"
                            aria-label="About project">{{ _('button.card_about') }}</a>
                        <a class="work-modal__btn" href="{{ project.github_url }}" target="_blank" rel="noopener"
                            data-i18n="button.github">{{ _('button.github') }}</a>
                        {% if project.demo_url %}
                        <a class="work-modal__btn" href="{{ project.demo_url }}" target="_blank" rel="noopener"
                            data-i18n="button.live">{{
                            _('button.live') }}</a>
                        {% else %}
                        <span class="work-modal__btn" aria-disabled="true" data-i18n="button.live">{{ _('button.live')
                            }}</span>
                        {% endif %}
                    </div>
                    {% if project.readme_html %}
                    <div class="card__meta">
                        <button class="readme-toggle" type="button" aria-expanded="false" data-i18n="button.details">{{
                            _('button.details') }}</button>
                        <div class="card-readme" hidden>{{ project.readme_html | safe }}</div>
                    </div>
                    {% endif %}
                </div>
            </article>
            {% endfor %}
        </div>
    </div>
</div>